# 注册登录与个人中心

## 说明

APP接口的访问会经过网关转发到各个服务，此处应该是配置文件中配置项

1. 开发网关：`http://localhost:7000/apis/auth-api/`

2. 测试网关：`http://ip地址/apis/auth-api/`

3. 正式网关：`http(s)://域名/apis/auth-api/`

> 参数说明

全局采用`POST`请求，`code`为`0`表示请求成功，其他为错误，消息在`msg`中

> 通用返回成功/失败

```bash
{
	"code":0,
	"msg":"ok"
}

{
	"code":500,
	"msg":"手机号必须填写！"
}
```

## 注册与登录

### ✔获取验证码

**注意**：开发，测试验证码不会发送到手机上。

**URL**：`app/captcha/{type}/{phone}`

**示例**：

```bash
POST - app/captcha/login/13011111111

# type目前可选
# 1. login    登录
# 2. reg      注册
# 3. rebind   重新绑定
```

**返回**：通用

### ✔注册用户

**URL**：`app/reg/reg_by_captcha`

**示例**：

```bash
POST - app/reg/reg_by_captcha
{
	"account":"手机号",
	"password":"验证码",
	"role_key":"角色，普通用户C,维修人员P",
	"IMEI":"国际移动设备识别码",
	"IMSI":"国际移动用户识别码",
	"phone_os":"手机操作系统信息",
}
```

**返回**：通用

### ✔用户登录

**URL**：`app/reg/login_by_captcha`

**示例**：

```bash
POST - app/reg/reg_by_captcha
{
	"account":"手机号",
	"password":"验证码",
	"role_key":"角色，普通用户C,维修人员P",
	"IMEI":"国际移动设备识别码",
	"IMSI":"国际移动用户识别码",
	"login_ip":"登录ip",
}
```

**返回**：

```bash
{
	"code":0,
	"msg":"ok",
	"data":{
		"id":"用户标识",
		"token":"token"
	}
}
```

## 个人中心

### ✔首页信息展示

返回用户信息和订单信息

**URL**：`app/user/index/{uid}`

**示例**：

```bash
POST - app/user/index/用户标识
HEADER x-access-token:token
HEADER x-user-id:user_id
```

**返回**：

```bash
{
	"code":0,
	"msg":"ok",
	"data":{
		"id":"用户标识",
		"user_name":"用户名称",
		"user_phone":"用户手机号",
		"real_status":"实名状态1认证/0未认证",
		"user_sale":{
			"need_to_pay":"待付款",
			"need_to_be_served":"待维修",
			"need_to_comment":"待评论",
			"after_sale_count":"售后"
		}
	}
}
```

## 信息维护

### ✔获取个人信息

**URL**：`app/user/info/{uid}`

**示例**：

```bash
POST - app/user/info/用户标识
HEADER x-access-token:token
HEADER x-user-id:user_id
```

**返回**：

```bash
{
	"code":0,
	"msg":"ok",
	"data":{
		"id":"用户标识",
		"user_name":"用户名称",
		"user_phone":"用户手机号",
		"sex":"性别1男/2女/3保密",
		"real_name":"真实姓名"
	}
}
```

### 个人资料修改

**说明**：头像无法修改，暂不支持修改

#### ✔修改用户名

**URL**：`app/user/name`

**示例**：

```bash
POST - app/user/name
HEADER x-access-token:token
HEADER x-user-id:user_id
{
	"uid":"用户标识",
	"user_name":"修改后的名称"
}
```

**返回**：通用

#### ✔修改性别

**URL**：`app/user/gender`

**示例**：

```bash
POST - app/user/gender
HEADER x-access-token:token
HEADER x-user-id:user_id
{
	"uid":"用户标识",
	"sex":"性别1男/2女/3保密"
}
```

**返回**：通用

#### ✔修改手机号

**URL**：`app/user/phone`

**示例**：

```bash
POST - app/user/phone
HEADER x-access-token:token
HEADER x-user-id:user_id
{
	"uid":"用户标识",
	"new_phone":"新手机号",
	"old_phone":"旧手机号",
	"role_key":"角色，普通用户C,维修人员P",
	"password":"验证码",
	"IMEI":"手机IMEI号",
	"IMSI":"手机IMEI号",
	"phone_os":"手机操作系统信息"
}
```

**返回**：通用

#### ✔实名认证（未开发）

**URL**：`app/user/real`

**示例**：

```bash
POST - app/user/real
HEADER x-access-token:token
HEADER x-user-id:user_id
{
	"uid":"用户标识",
	"id_card_no":"身份证卡号",
	"real_name":"真实姓名",
	"img_front":"身份证正面",
	"img_back":"身份证反面",
	"img_yours":"手持身份证",
}
```

**返回**：通用
